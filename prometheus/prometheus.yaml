global:
  scrape_interval: 15s
  evaluation_interval: 30s

scrape_configs:
- job_name: 'kube-state-metrics'
  kubernetes_sd_configs:
  - role: endpoints
  relabel_configs:
  - source_labels: [__meta_kubernetes_namespace]
    regex: kube-system
    action: keep
  - source_labels: [__meta_kubernetes_service_name]
    regex: kube-state-metrics
    action: keep
  metrics_path: /metrics

- job_name: 'fleetcast-backend'
  kubernetes_sd_configs:
  - role: pod
  relabel_configs:
  - source_labels: [__meta_kubernetes_namespace]
    regex: fleetcast
    action: keep
  - source_labels: [__meta_kubernetes_pod_label_app_kubernetes_io_name]
    regex: fleetcast-backend
    action: keep
  - source_labels: [__meta_kubernetes_pod_ip]
    target_label: __address__
    replacement: '$1:8000'
  metrics_path: /metrics
  scheme: http

- job_name: 'pd-pods'
  kubernetes_sd_configs:
  - role: pod
  relabel_configs:
  - source_labels: [__meta_kubernetes_namespace]
    regex: tidb-cluster
    action: keep
  - source_labels: [__meta_kubernetes_pod_label_app_kubernetes_io_component]
    regex: pd
    action: keep
  - source_labels: [__meta_kubernetes_pod_ip]
    target_label: __address__
    replacement: '$1:2379'
  metrics_path: /metrics

- job_name: 'tikv-pods'
  kubernetes_sd_configs:
  - role: pod
  relabel_configs:
  - source_labels: [__meta_kubernetes_namespace]
    regex: tidb-cluster
    action: keep
  - source_labels: [__meta_kubernetes_pod_label_app_kubernetes_io_component]
    regex: tikv
    action: keep
  - source_labels: [__meta_kubernetes_pod_ip]
    target_label: __address__
    replacement: '$1:20180'
  metrics_path: /metrics

- job_name: 'tidb-pods'
  kubernetes_sd_configs:
  - role: pod
  relabel_configs:
  - source_labels: [__meta_kubernetes_namespace]
    regex: tidb-cluster
    action: keep
  - source_labels: [__meta_kubernetes_pod_label_app_kubernetes_io_component]
    regex: tidb
    action: keep
  - source_labels: [__meta_kubernetes_pod_ip]
    target_label: __address__
    replacement: '$1:10080'
  metrics_path: /metrics
